/*
	@version 0.1.6
	https://github.com/smolk/angular.treeview

	@fork from:
	@license Angular Treeview version 0.1.6
	â“’ 2013 AHN JAE-HA http://github.com/eu81273/angular.treeview
	License: MIT


	[TREE attribute]
	angular-treeview: the treeview directive
	tree-id : each tree's unique id.
	tree-model : the tree model on $scope.
	node-id : each node's id
	node-label : each node's label
	node-children: each node's children
 	node-filter: free text to search in tree nodes

	<div
		data-angular-treeview="true"
		data-tree-id="tree"
		data-tree-model="roleList"
		data-node-id="roleId"
		data-node-label="roleName"
		data-node-children="children"
 		data-node-filter="freeTextSearch">
	</div>
*/
!function(e){"use strict";e.module("angularTreeview",[]).directive("treeModel",["$compile","$log","$timeout",function(n,t,d){var l=13,i=37,a=38,o=39,r=40;return{restrict:"A",link:function(t,c,f){function s(e,n){for(var t=0;t<e.length;t++)e[t].collapsed=!!n,"undefined"!=typeof e[t][x]&&e[t][x].length>0&&s(e[t][x])}function g(n){e.element(n).find("i.collapsed:not(.ng-hide)").length?d(function(){e.element(n).find("i.collapsed:not(.ng-hide)").first().triggerHandler("click")}):p(n)}function u(n){var t=e.element(n).parentsUntil(e.element("[data-angular-treeview]"),"li");return t.length>1?(e.element(t[1]).find("a").first().focus(),e.element(t[1]).find("a").first()):void 0}function p(n,t){if(e.element(n).find("i.expanded:not(.ng-hide)").length&&!t&&e.element(n).parent().find("ul a").length)return void e.element(n).parent().find("ul a").first().focus();if(e.element(n).parent().next("li").length)e.element(n).parent().next("li").find("a").first().focus();else{var d=u(n);d&&p(d,!0)}}function h(n){e.element(n).parent().prev("li").length?e.element(n).parent().prev("li").find("a").first().focus():u(n)}function v(n){d(function(){e.element(n).find(".node_title").first().triggerHandler("click")})}function m(n){return e.element(n).find("i.expanded:not(.ng-hide)").length?(d(function(){e.element(n).find("i.expanded:not(.ng-hide)").first().triggerHandler("click")}),!0):!1}var N=f.treeId,k=N?N+".":"",w=f.treeModel,H=f.nodeId||"id",b=f.nodeLabel||"label",x=f.nodeChildren||"children",y=f.nodeIsfolder||"isfolder",C=f.nodeFilter||"",D=""!==C?" | filter: "+C:"",L=""!==C?" | nodehighlight: "+C:"",I='<ul><li data-ng-repeat="node in '+w+D+'"><a href="" class="nodewrap" ng-class="{activenode: node.'+H+" == "+k+"currentNode."+H+" && !!node."+H+'}"><i class="collapsed" data-ng-show="(node.'+y+" || node."+x+'.length) && node.collapsed" data-ng-click="'+k+'selectNodeHead(node)"></i><i class="expanded" data-ng-show="(node.'+y+" || node."+x+'.length) && !node.collapsed" data-ng-click="'+k+'selectNodeHead(node)"></i><i class="normal" data-ng-hide="node.'+y+" || node."+x+'.length"></i> <span class="node_title" data-ng-click="'+k+'selectNodeLabel(node)" ng-bind-html="node.'+b+L+'"></span></a><div ng-if="!node.collapsed" data-ng-hide="node.collapsed" '+(N?'data-tree-id="'+N+'"':"")+' data-tree-model="node.'+x+'" data-node-id='+H+" data-node-label="+b+" data-node-children="+x+' data-node-filter="'+C+'"></div></li></ul>';if(w){if(f.angularTreeview){var _=t;N&&(_=t[N]=t[N]||{}),_.selectNodeHead=_.selectNodeHead||function(e){e.collapsed=!e.collapsed},_.selectNodeLabel=_.selectNodeLabel||function(e){return e[y]?_.selectNodeHead(e):(_.currentNode&&_.currentNode.selected&&(_.currentNode.selected=void 0),e.selected="selected",void(_.currentNode=e))},C&&t.$watch(C,function(e,n){(e||n)&&s(t[w],!e)})}c.html("").append(n(I)(t))}t.onKeyPress=function(e){if(e.keyCode==o&&(g(e.target),e.preventDefault()),e.keyCode==r&&(p(e.target),e.preventDefault()),e.keyCode==a&&(h(e.target),e.preventDefault()),e.keyCode==i){if(m(e.target))return;var n=u(e.target);n?m(n):h(e.target),e.preventDefault()}e.keyCode==l&&(v(e.target),e.preventDefault())}}}}]).filter("nodehighlight",function(){return function(e,n){return n&&e?e=e.toString().replace(new RegExp(n.toString(),"gi"),'<span class="node_highlight">$&</span>'):e}})}(angular);