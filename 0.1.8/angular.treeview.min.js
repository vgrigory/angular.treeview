!function(e){"use strict";e.module("angularTreeview",[]).directive("treeModel",["$compile","$log","$timeout",function(n,t,d){return{restrict:"A",link:function(t,l,i){var a=i.treeId,o=a?a+".":"",r=i.treeModel,s=i.nodeId||"id",c=i.nodeLabel||"label",f=i.nodeChildren||"children",u=i.nodeIsfolder||"isfolder",g=!!i.showDisabledNodes,h=i.nodeFilter||"",p=""!==h?" | filter:searchTree(this)":"";g&&""!==h&&(p=" | filter: "+h);var v='<ul><li ng-hide="node.disabled && '+!g+'" data-ng-repeat="node in '+r+p+'"><a href="" class="nodewrap" ng-class="{activenode: node.'+s+" == "+o+"currentNode."+s+" && !!node."+s+', disablednode: node.disabled}"><i class="collapsed" data-ng-show="'+o+'shouldRenderAsFolder(node) && node.collapsed" data-ng-click="'+o+'selectNodeHead(node)"></i><i class="expanded" data-ng-show="'+o+'shouldRenderAsFolder(node) && !node.collapsed" data-ng-click="'+o+'selectNodeHead(node)"></i><i class="normal" data-ng-hide="'+o+'shouldRenderAsFolder(node)"></i> <span class="node_title" ng_class="{\'node_title\': true, \'saved_node\': node.selected}" data-ng-click="'+o+'selectNodeLabel(node)" ng-bind-html="node.'+c+(""!==h?" | nodehighlight: "+h:"")+'"></span></a><div ng-if="!node.collapsed" data-ng-hide="node.collapsed" '+(a?'data-tree-id="'+a+'"':"")+' data-tree-model="node.'+f+'" data-node-id='+s+" data-node-label="+c+" data-node-children="+f+' data-node-filter="'+h+'" data-show-disabled-nodes="'+g+'"></div></li></ul>';if(r){if(i.angularTreeview){var m=t;a&&(m=t[a]=t[a]||{}),m.shouldRenderAsFolder=function(e){var n,t=e[f]?e[f].length:0,d=!0;if(g&&(e[u]||t))return!0;for(n=0;n<t;n++)if(!e[f][n].disabled){d=!1;break}return(e[u]||t)&&!d},m.selectNodeHead=m.selectNodeHead||function(e){e.collapsed=!e.collapsed},m.selectNodeLabel=m.selectNodeLabel||function(e){if(e[u])return m.selectNodeHead(e);m.currentNode&&m.currentNode.selected&&(m.currentNode.selected=void 0),e.selected="selected",m.currentNode=e},h&&t.$watch(h,function(e,n){(e||n)&&function e(n,t){for(var d=0;d<n.length;d++)n[d].collapsed=!!t,void 0!==n[d][f]&&n[d][f].length>0&&e(n[d][f])}(t[r],!e)})}l.html("").append(n(v)(t))}function b(n){var t=e.element(n).parentsUntil(e.element("[data-angular-treeview]"),"li");if(t.length>1)return e.element(t[1]).find("a").first().focus(),e.element(t[1]).find("a").first()}function N(n,t){if(e.element(n).find("i.expanded:not(.ng-hide)").length&&!t&&e.element(n).parent().find("ul a").length)e.element(n).parent().find("ul a").first().focus();else if(e.element(n).parent().next("li").length)e.element(n).parent().next("li").find("a").first().focus();else{var d=b(n);d&&N(d,!0)}}function k(n){e.element(n).parent().prev("li").length?e.element(n).parent().prev("li").find("a").first().focus():b(n)}function w(n){return!!e.element(n).find("i.expanded:not(.ng-hide)").length&&(d(function(){e.element(n).find("i.expanded:not(.ng-hide)").first().triggerHandler("click")}),!0)}t.onKeyPress=function(n){var t,l;if(39==n.keyCode&&(t=n.target,e.element(t).find("i.collapsed:not(.ng-hide)").length?d(function(){e.element(t).find("i.collapsed:not(.ng-hide)").first().triggerHandler("click")}):N(t),n.preventDefault()),40==n.keyCode&&(N(n.target),n.preventDefault()),38==n.keyCode&&(k(n.target),n.preventDefault()),37==n.keyCode){if(w(n.target))return;var i=b(n.target);i?w(i):k(n.target),n.preventDefault()}13==n.keyCode&&(l=n.target,d(function(){e.element(l).find(".node_title").first().triggerHandler("click")}),n.preventDefault())}}}}]).filter("nodehighlight",function(){return function(e,n){return n&&e?e=e.toString().replace(new RegExp(n.toString(),"gi"),'<span class="node_highlight">$&</span>'):e}})}(angular);
