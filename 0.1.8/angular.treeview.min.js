!function(e){"use strict";e.module("angularTreeview",[]).directive("treeModel",["$compile","$log","$timeout",function(n,t,d){return{restrict:"A",link:function(t,l,i){function a(e,n){for(var t=0;t<e.length;t++)e[t].collapsed=!!n,void 0!==e[t][N]&&e[t][N].length>0&&a(e[t][N])}function o(n){e.element(n).find("i.collapsed:not(.ng-hide)").length?d(function(){e.element(n).find("i.collapsed:not(.ng-hide)").first().triggerHandler("click")}):c(n)}function r(n){var t=e.element(n).parentsUntil(e.element("[data-angular-treeview]"),"li");if(t.length>1)return e.element(t[1]).find("a").first().focus(),e.element(t[1]).find("a").first()}function c(n,t){if(e.element(n).find("i.expanded:not(.ng-hide)").length&&!t&&e.element(n).parent().find("ul a").length)e.element(n).parent().find("ul a").first().focus();else if(e.element(n).parent().next("li").length)e.element(n).parent().next("li").find("a").first().focus();else{var d=r(n);d&&c(d,!0)}}function s(n){e.element(n).parent().prev("li").length?e.element(n).parent().prev("li").find("a").first().focus():r(n)}function f(n){d(function(){e.element(n).find(".node_title").first().triggerHandler("click")})}function g(n){return!!e.element(n).find("i.expanded:not(.ng-hide)").length&&(d(function(){e.element(n).find("i.expanded:not(.ng-hide)").first().triggerHandler("click")}),!0)}var u=i.treeId,p=u?u+".":"",h=i.treeModel,m=i.nodeId||"id",v=i.nodeLabel||"label",N=i.nodeChildren||"children",b=i.nodeIsfolder||"isfolder",k=i.nodeFilter||"",w='<ul><li ng-hide="node.disabled" data-ng-repeat="node in '+h+(""!==k?" | filter: "+k:"")+'"><a href="" class="nodewrap" ng-class="{activenode: node.'+m+" == "+p+"currentNode."+m+" && !!node."+m+', disablednode: node.disabled}"><i class="collapsed" data-ng-show="(node.'+b+" || node."+N+'.length) && node.collapsed" data-ng-click="'+p+'selectNodeHead(node)"></i><i class="expanded" data-ng-show="(node.'+b+" || node."+N+'.length) && !node.collapsed" data-ng-click="'+p+'selectNodeHead(node)"></i><i class="normal" data-ng-hide="node.'+b+" || node."+N+'.length"></i> <span class="node_title" data-ng-click="'+p+'selectNodeLabel(node)" ng-bind-html="node.'+v+(""!==k?" | nodehighlight: "+k:"")+'"></span></a><div ng-if="!node.collapsed" data-ng-hide="node.collapsed" '+(u?'data-tree-id="'+u+'"':"")+' data-tree-model="node.'+N+'" data-node-id='+m+" data-node-label="+v+" data-node-children="+N+' data-node-filter="'+k+'"></div></li></ul>';if(h){if(i.angularTreeview){var H=t;u&&(H=t[u]=t[u]||{}),H.selectNodeHead=H.selectNodeHead||function(e){e.disabled||(e.collapsed=!e.collapsed)},H.selectNodeLabel=H.selectNodeLabel||function(e){if(!e.disabled){if(e[b])return H.selectNodeHead(e);H.currentNode&&H.currentNode.selected&&(H.currentNode.selected=void 0),e.selected="selected",H.currentNode=e}},k&&t.$watch(k,function(e,n){(e||n)&&a(t[h],!e)})}l.html("").append(n(w)(t))}t.onKeyPress=function(e){if(39==e.keyCode&&(o(e.target),e.preventDefault()),40==e.keyCode&&(c(e.target),e.preventDefault()),38==e.keyCode&&(s(e.target),e.preventDefault()),37==e.keyCode){if(g(e.target))return;var n=r(e.target);n?g(n):s(e.target),e.preventDefault()}13==e.keyCode&&(f(e.target),e.preventDefault())}}}}]).filter("nodehighlight",function(){return function(e,n){return n&&e?e=e.toString().replace(new RegExp(n.toString(),"gi"),'<span class="node_highlight">$&</span>'):e}})}(angular);