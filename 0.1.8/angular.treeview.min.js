!function(e){"use strict";e.module("angularTreeview",[]).directive("treeModel",["$compile","$log","$timeout",function(n,t,d){return{restrict:"A",link:function(t,l,i){function a(e,n){for(var t=0;t<e.length;t++)e[t].collapsed=!!n,void 0!==e[t][b]&&e[t][b].length>0&&a(e[t][b])}function o(n){e.element(n).find("i.collapsed:not(.ng-hide)").length?d(function(){e.element(n).find("i.collapsed:not(.ng-hide)").first().triggerHandler("click")}):c(n)}function r(n){var t=e.element(n).parentsUntil(e.element("[data-angular-treeview]"),"li");if(t.length>1)return e.element(t[1]).find("a").first().focus(),e.element(t[1]).find("a").first()}function c(n,t){if(e.element(n).find("i.expanded:not(.ng-hide)").length&&!t&&e.element(n).parent().find("ul a").length)e.element(n).parent().find("ul a").first().focus();else if(e.element(n).parent().next("li").length)e.element(n).parent().next("li").find("a").first().focus();else{var d=r(n);d&&c(d,!0)}}function s(n){e.element(n).parent().prev("li").length?e.element(n).parent().prev("li").find("a").first().focus():r(n)}function f(n){d(function(){e.element(n).find(".node_title").first().triggerHandler("click")})}function u(n){return!!e.element(n).find("i.expanded:not(.ng-hide)").length&&(d(function(){e.element(n).find("i.expanded:not(.ng-hide)").first().triggerHandler("click")}),!0)}var g=i.treeId,h=g?g+".":"",p=i.treeModel,m=i.nodeId||"id",v=i.nodeLabel||"label",b=i.nodeChildren||"children",k=i.nodeIsfolder||"isfolder",N=i.nodeFilter||"",w='<ul><li ng-hide="node.disabled" data-ng-repeat="node in '+p+(""!==N?" | filter:searchTree(this)":"")+'"><a href="" class="nodewrap" ng-class="{activenode: node.'+m+" == "+h+"currentNode."+m+" && !!node."+m+', disablednode: node.disabled}"><i class="collapsed" data-ng-show="'+h+'shouldRenderAsFolder(node) && node.collapsed" data-ng-click="'+h+'selectNodeHead(node)"></i><i class="expanded" data-ng-show="'+h+'shouldRenderAsFolder(node) && !node.collapsed" data-ng-click="'+h+'selectNodeHead(node)"></i><i class="normal" data-ng-hide="'+h+'shouldRenderAsFolder(node)"></i> <span class="node_title" data-ng-click="'+h+'selectNodeLabel(node)" ng-bind-html="node.'+v+(""!==N?" | nodehighlight: "+N:"")+'"></span></a><div ng-if="!node.collapsed" data-ng-hide="node.collapsed" '+(g?'data-tree-id="'+g+'"':"")+' data-tree-model="node.'+b+'" data-node-id='+m+" data-node-label="+v+" data-node-children="+b+' data-node-filter="'+N+'"></div></li></ul>';if(p){if(i.angularTreeview){var H=t;g&&(H=t[g]=t[g]||{}),H.shouldRenderAsFolder=function(e){var n,t=e[b]?e[b].length:0,d=!0;for(n=0;n<t;n++)if(!e[b][n].disabled){d=!1;break}return(e[k]||t)&&!d},H.selectNodeHead=H.selectNodeHead||function(e){e.disabled||(e.collapsed=!e.collapsed)},H.selectNodeLabel=H.selectNodeLabel||function(e){if(!e.disabled){if(e[k])return H.selectNodeHead(e);H.currentNode&&H.currentNode.selected&&(H.currentNode.selected=void 0),e.selected="selected",H.currentNode=e}},N&&t.$watch(N,function(e,n){(e||n)&&a(t[p],!e)})}l.html("").append(n(w)(t))}t.onKeyPress=function(e){if(39==e.keyCode&&(o(e.target),e.preventDefault()),40==e.keyCode&&(c(e.target),e.preventDefault()),38==e.keyCode&&(s(e.target),e.preventDefault()),37==e.keyCode){if(u(e.target))return;var n=r(e.target);n?u(n):s(e.target),e.preventDefault()}13==e.keyCode&&(f(e.target),e.preventDefault())}}}}]).filter("nodehighlight",function(){return function(e,n){return n&&e?e=e.toString().replace(new RegExp(n.toString(),"gi"),'<span class="node_highlight">$&</span>'):e}})}(angular);
