!function(e){"use strict";e.module("angularTreeview",[]).directive("treeModel",["$compile","$log","$timeout",function(n,t,d){return{restrict:"A",link:function(t,l,i){function a(e,n){for(var t=0;t<e.length;t++)e[t].collapsed=!!n,void 0!==e[t][b]&&e[t][b].length>0&&a(e[t][b])}function o(n){e.element(n).find("i.collapsed:not(.ng-hide)").length?d(function(){e.element(n).find("i.collapsed:not(.ng-hide)").first().triggerHandler("click")}):s(n)}function r(n){var t=e.element(n).parentsUntil(e.element("[data-angular-treeview]"),"li");if(t.length>1)return e.element(t[1]).find("a").first().focus(),e.element(t[1]).find("a").first()}function s(n,t){if(e.element(n).find("i.expanded:not(.ng-hide)").length&&!t&&e.element(n).parent().find("ul a").length)e.element(n).parent().find("ul a").first().focus();else if(e.element(n).parent().next("li").length)e.element(n).parent().next("li").find("a").first().focus();else{var d=r(n);d&&s(d,!0)}}function c(n){e.element(n).parent().prev("li").length?e.element(n).parent().prev("li").find("a").first().focus():r(n)}function f(n){d(function(){e.element(n).find(".node_title").first().triggerHandler("click")})}function u(n){return!!e.element(n).find("i.expanded:not(.ng-hide)").length&&(d(function(){e.element(n).find("i.expanded:not(.ng-hide)").first().triggerHandler("click")}),!0)}var g=i.treeId,h=g?g+".":"",p=i.treeModel,v=i.nodeId||"id",m=i.nodeLabel||"label",b=i.nodeChildren||"children",N=i.nodeIsfolder||"isfolder",k=!!i.showDisabledNodes,w=i.nodeFilter||"",H=""!==w?" | filter:searchTree(this)":"";k&&""!==w&&(H=" | filter: "+w);var x='<ul><li ng-hide="node.disabled && '+!k+'" data-ng-repeat="node in '+p+H+'"><a href="" class="nodewrap" ng-class="{activenode: node.'+v+" == "+h+"currentNode."+v+" && !!node."+v+', disablednode: node.disabled}"><i class="collapsed" data-ng-show="'+h+'shouldRenderAsFolder(node) && node.collapsed" data-ng-click="'+h+'selectNodeHead(node)"></i><i class="expanded" data-ng-show="'+h+'shouldRenderAsFolder(node) && !node.collapsed" data-ng-click="'+h+'selectNodeHead(node)"></i><i class="normal" data-ng-hide="'+h+'shouldRenderAsFolder(node)"></i> <span class="node_title" data-ng-click="'+h+'selectNodeLabel(node)" ng-bind-html="node.'+m+(""!==w?" | nodehighlight: "+w:"")+'"></span></a><div ng-if="!node.collapsed" data-ng-hide="node.collapsed" '+(g?'data-tree-id="'+g+'"':"")+' data-tree-model="node.'+b+'" data-node-id='+v+" data-node-label="+m+" data-node-children="+b+' data-node-filter="'+w+'" data-show-disabled-nodes="'+k+'"></div></li></ul>';if(p){if(i.angularTreeview){var y=t;g&&(y=t[g]=t[g]||{}),y.shouldRenderAsFolder=function(e){var n,t=e[b]?e[b].length:0,d=!0;if(k&&(e[N]||t))return!0;for(n=0;n<t;n++)if(!e[b][n].disabled){d=!1;break}return(e[N]||t)&&!d},y.selectNodeHead=y.selectNodeHead||function(e){e.collapsed=!e.collapsed},y.selectNodeLabel=y.selectNodeLabel||function(e){if(e[N])return y.selectNodeHead(e);y.currentNode&&y.currentNode.selected&&(y.currentNode.selected=void 0),e.selected="selected",y.currentNode=e},w&&t.$watch(w,function(e,n){(e||n)&&a(t[p],!e)})}l.html("").append(n(x)(t))}t.onKeyPress=function(e){if(39==e.keyCode&&(o(e.target),e.preventDefault()),40==e.keyCode&&(s(e.target),e.preventDefault()),38==e.keyCode&&(c(e.target),e.preventDefault()),37==e.keyCode){if(u(e.target))return;var n=r(e.target);n?u(n):c(e.target),e.preventDefault()}13==e.keyCode&&(f(e.target),e.preventDefault())}}}}]).filter("nodehighlight",function(){return function(e,n){return n&&e?e=e.toString().replace(new RegExp(n.toString(),"gi"),'<span class="node_highlight">$&</span>'):e}})}(angular);
